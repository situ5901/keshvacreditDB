const express = require("express");
const mongoose = require("mongoose"); 
const router = express.Router();
const User = require("../models/user.model.js"); 

// âœ… Flexible Schema
const loopSchema = new mongoose.Schema({}, { strict: false });
const Loop = mongoose.model("loop", loopSchema);

// âœ… POST API to store any data
router.post("/post-data", async (req, res) => {
  try {
    console.log("ðŸ”¹ Received Data:", req.body);

    // âœ… Check if request body is empty
    if (!req.body || Object.keys(req.body).length === 0) {
      console.log("ðŸš« No Data Provided");
      return res.status(400).json({ 
        status: "failed",
        message: "No data provided" 
      });
    }

    // âœ… Save data to MongoDB
    const newData = new Loop(req.body);
    await newData.save();

    console.log("âœ… Data Saved:", newData);
    res.status(201).json({ 
      status: "success",
      message: "Lead created successfully",
      data: newData 
    });

  } catch (error) {
    console.error("ðŸš« Error Saving Data:", error);
    res.status(500).json({ 
      status: "error",
      message: error.message || "Internal Server Error"
    });
  }
});

module.exports = router; // âœ… Export Router
